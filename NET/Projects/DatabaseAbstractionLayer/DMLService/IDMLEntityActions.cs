/* 
 This source code (the "Generated Software") is generated by the OutSystems Platform 
 and is licensed by OutSystems (http://www.outsystems.com) to You solely for testing and evaluation 
 purposes, unless You and OutSystems have executed a specific agreement covering the use terms and 
 conditions of the Generated Software, in which case such agreement shall apply. 
*/

using OutSystems.HubEdition.Extensibility.Data.DatabaseObjects;
using OutSystems.HubEdition.Extensibility.Data.DMLService.DMLPlaceholders;
using System.Collections.Generic;

namespace OutSystems.HubEdition.Extensibility.Data.DMLService {

    /// <summary>
    /// Represents the different kinds of entity actions supported by the platform.
    /// </summary>
    public enum EntityActionKind { Get, GetForUpdate, Update, Create, Delete }

    /// <summary>
    /// Represents the supported methods to retrieve an entity identifier after the correspondent record is inserted.
    /// </summary>
    public enum RetrieveIdMethod { 
        /// <summary>
        /// Retrieve the identifier using an output parameter associated to the command.
        /// </summary>
        OutputParameter, 
        /// <summary>
        /// Retrieve the identifier by reading the first column of the first row in the resultset returned by the command.
        /// </summary>
        ReturnValue 
    }

    /// <summary>
    /// Defines a contract for generating DML fragments required by applications to execute entity actions.
    /// </summary>
    public interface IDMLEntityActions {

        /// <summary>
        /// Gets the associated DML service.
        /// </summary>
        /// <value>
        /// The DML service associated.
        /// </value>
        IDMLService DMLService { get; }

        /// <summary>
        /// Gets information about this entity's underlying table source, needed by the platform for DML generation purposes.
        /// This information should be passed to the object's constructor in <see cref="IDMLService.GetEntityActions" />.
        /// </summary>
        /// <value>
        /// Information about this entity's underlying table source.
        /// </value>
        ITableSourceInfo TableSourceInfo { get; }

        /// <summary>
        /// Returns the table name of this entity to be used in the entity action specified. 
        /// </summary>
        /// <param name="action">Entity action to be considered for table name overriding.</param>
        /// <returns>The table name of this entity if it needs to be overridden, otherwise returns Null.</returns>
        string GetInlineTableName(EntityActionKind action);

        /// <summary>
        /// Returns True if this entity requires the parameter values to be dumped inline for a given entity action kind. 
        /// </summary>
        /// <param name="action">Entity action whose requirement for inline parameter values is to be tested.</param>
        /// <returns>A boolean indicating whether this entity requires inline parameter values or not.</returns>
        bool RequiresInlineParameterValues(EntityActionKind action);

        /// <summary>
        /// Returns True if this entity requires the table names to be dumped inline for a given entity action kind. 
        /// </summary>
        /// <param name="action">Entity action whose requirement for inline table names is to be tested.</param>
        /// <returns>A boolean indicating whether this entity requires inline table names or not.</returns>
        bool RequiresInlineTableNames(EntityActionKind action);

        /// <summary>
        /// Returns additional DML expressions to be inserted in the <code>SELECT</code> statement
        /// generated by the platform for the <code>Get</code> entity action.
        /// </summary>
        /// <returns>An <see cref="IDictionary{TKey,TValue}"/> with the DML expression.</returns>
        IDictionary<SelectPlaceholder, string> SQLPlaceholderValuesForGet();

        /// <summary>
        /// Returns additional DML expression to be inserted in the <code>SELECT</code> statement
        /// generated by the platform for the <code>GetForUpdate</code> entity action.
        /// </summary>
        /// <returns>An <see cref="IDictionary{TKey,TValue}"/> with the DML expression.</returns>
        IDictionary<SelectPlaceholder, string> SQLPlaceholderValuesForGetForUpdate();

        /// <summary>
        /// Returns additional DML expressions to be inserted in the <code>SELECT</code> statement
        /// generated by the platform for the <code>Create</code> entity action.
        /// </summary>
        /// <returns>An <see cref="IDictionary{TKey,TValue}"/> with the DML expression.</returns>
        IDictionary<InsertPlaceholder, string> SQLPlaceholderValuesForCreate();

        /// <summary>
        /// Returns additional DML expression to be inserted in the <code>SELECT</code> statement
        /// generated by the platform for the <code>Create</code> entity action, when it's necessary
        /// to retrieve the <code>Id</code> of the record created.
        /// </summary>
        /// <param name="idColumnName">Column that stores the identifiers.</param>
        /// <param name="outputParameterName">If the <code>retrieveIdMethod</code> is <code>OutputParameter</code>, this is the name of the parameter that will hold the value stored 
        /// in <code>idColumnName</code>, including the parameter prefix, otherwise it should be ignored.</param>
        /// <param name="retrieveIdMethod">Method used by the platform to retrieve the identifier.</param>
        /// <returns>An <see cref="IDictionary{TKey,TValue}"/> with the DML expressions.</returns>
        IDictionary<InsertPlaceholder, string> SQLPlaceholderValuesForCreateAndRetrieveId(string idColumnName, string outputParameterName, out RetrieveIdMethod retrieveIdMethod);

        /// <summary>
        /// Returns additional DML expressions to be inserted in the <code>UPDATE</code> statement
        /// generated by the platform for the <code>Update</code> entity action.
        /// </summary>
        /// <returns>An <see cref="IDictionary{TKey,TValue}"/> with the DML expressions.</returns>
        IDictionary<UpdatePlaceholder, string> SQLPlaceholderValuesForUpdate();

        /// <summary>
        /// Returns additional DML expressions to be inserted in the <code>DELETE</code> statement
        /// generated by the platform for the <code>Delete</code> entity action.
        /// </summary>
        /// <returns>An <see cref="IDictionary{TKey,TValue}"/> with the DML expressions.</returns>
        IDictionary<DeletePlaceholder, string> SQLPlaceholderValuesForDelete();
    }
}
